#!/usr/bin/env bash
##
## macos: macOS-env specific functions.
##

#Open a specfied OSX PrefPane
function osx-pref {
  if [[ ! -z "$1" ]]; then
    if [[ -d "/System/Library/PreferencePanes/$1.prefPane" ]]; then
      open "/System/Library/PreferencePanes/$1.prefPane"
    fi
  fi
}

#Connect to a Tunnelblick configured VPN
function osx-ovpn-connect {
  if [[ -z "$1" ]]; then
    return 1
  fi
  /usr/bin/env osascript <<-EOF
tell application "Tunnelblick"
  connect "$1"
end tell
EOF
}

#Disconnect to a Tunnelblick configured VPN
function osx-ovpn-disconnect {
  if [[ -z "$1" ]]; then
    return 1
  fi
  /usr/bin/env osascript <<-EOF
tell application "Tunnelblick"
  disconnect "$1"
end tell
EOF
}

#Connect to a MacOSX configured VPN
#Config is stored in /Library/Preferences/SystemConfiguration/preferences.plist
function osx-vpn-connect {
  if [[ -z "$1" ]]; then
    return 1
  fi
  /usr/bin/env osascript <<-EOF
tell application "System Events"
  tell current location of network preferences
    set VPN to service "$1"
    if exists VPN then connect VPN
    repeat while (current configuration of VPN is not connected)
      delay 1
    end repeat
  end tell
end tell
EOF
}

#Disconnect from a MacOSX configured VPN
#Config is stored in /Library/Preferences/SystemConfiguration/preferences.plist
function osx-vpn-disconnect {
  if [[ -z "$1" ]]; then
    return 1
  fi
  /usr/bin/env osascript <<-EOF
tell application "System Events"
  tell current location of network preferences
    set VPN to service "$1"
    if exists VPN then disconnect VPN
  end tell
end tell
return
EOF
}

#Attempt WiFi Relogin
function osx-wifi-relogin {
  echo "GATEWAY: http://"$(netstat -rn | grep default | awk '{print $2}')/
  open "http://www.gstatic.com/generate_204"
}

